{% load humanize %}

<style>
.export-card-wrapper{
    width:480px;
    margin:10px auto 0 auto;
}

.export-title{
    background: linear-gradient(135deg, #3e3e3e, #5a5a5a);
    color:#fff;
    font-weight:700;
    font-size:19px;
    text-align:center;
    padding:12px 0;
    border-radius:10px 10px 0 0;
    letter-spacing:1px;
    box-shadow:0 3px 6px rgba(0,0,0,0.25);
}

.chart-container{text-align:center;margin:auto 20px;}
#progressChartExport{width:70px!important;height:70px!important;margin:auto;display:block;}
.head-chart-text{padding-top: 15px;margin-bottom:10px;font-size:18px;font-weight:600;color:#333;}
.chart-text{margin-top:10px;font-size:18px;font-weight:600;color:#333;}
.chart-subtext{font-weight:600;font-size:16px;color:#666;margin-top:4px;}

.cardInv{
    background-color:#eceef1;
    border-radius:0 0 10px 10px;
    box-shadow:0 3px 8px rgba(0,0,0,0.25);
    padding-bottom:20px;
}

.cardHeader{
    background-color:#714b67;
    color:white;
    font-weight:700;
    font-size:18px;
    padding:10px;
    text-align:center;
    border-radius:4px;
}

.cardBody{font-size:16px;color:#000;padding:12px 20px;line-height:1.8;}
.cardBody table{width:100%;border-collapse:collapse;}
.cardBody td{padding:4px 6px;}

.valueCell{font-size:30px;font-weight:600;text-align:center;}
.valueCelltxt{font-size:22px;font-weight:600;text-align:center;color:red;}

.mgr-row{margin-top:10px;}
.mgr-name{display:flex;justify-content:space-between;font-weight:600;}

.bar-outer{background:#787878;border-radius:20px;overflow:hidden;height:15px;margin-top:4px;}
.bar-inner{height:15px;line-height:13px;border-radius:20px;font-size:12px;font-weight:700;text-align:center;background:#ddd60a;}
</style>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="export-card-wrapper">

    <div class="export-title">EXPORT</div>

    <div class="cardInv">

        <div class="chart-container">
            <div class="head-chart-text">Order In Hand</div>
            <canvas id="progressChartExport"></canvas>

            <div class="chart-text">{{ percentage_loc }}% of Overall Order In Hand</div>
            <div class="chart-subtext">
                (Order In Hand: {{ curr_dispatch_loc|intcomma }} mtr / Out Of : {{ total_plan_loc|intcomma }} mtr)
            </div>
        </div>

        <div class="mgr-row">
            <div class="mgr-name">
                Matched Fabric Inventory
                <span>{{ inventory_loc|intcomma }}</span>
            </div>

            <div class="bar-outer">
                <div class="bar-inner" style="width:{{ inv_per }}%;">{{ inv_per }}%</div>
            </div>

            <div style="font-size:13px;font-weight:600;text-align:right;color:#555">
                Out Of Total Order In Hand: {{ curr_dispatch_loc|intcomma }}
            </div>
        </div>

        <div class="cardBody">
            <table>
                <tr><td class="valueCell">{{ curr_dispatch_loc }} MTR</td></tr>
                <tr><td class="valueCell">{{ amt_pkr_loc }} PKR</td></tr>
                <tr><td class="valueCell">{{ amt_loc }} @{{ d_rate_loc }} $</td></tr>
                <tr><td class="valueCell">{{ avg_rate_loc }} AVG RATE</td></tr>
                <tr><td class="valueCelltxt">BAL TO DYE {{ btd_loc }}</td></tr>
                <tr><td class="valueCelltxt">{{ days_loc }} DAYS OF DYEING</td></tr>    
            </table>
        </div>

        <div class="cardHeader">MANAGER WISE</div>

        <div class="cardBody">
            {% for m in managers %}
            <div class="mgr-row">
                <div class="mgr-name">
                    {{ m.manager_name }} 
                    <span>{{ m.dispatch_exp|intcomma }}</span>
                </div>

                <div class="bar-outer">
                    <div class="bar-inner" style="width:{{ m.per }}%;">{{ m.per }}%</div>
                </div>
            </div>
            {% endfor %}
        </div>

    </div>
    
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const ctx = document.getElementById("progressChartExport").getContext("2d");
    new Chart(ctx, {
        type: "doughnut",
        data: {
            datasets: [{
                data: [{{ curr_dispatch }}, {{ total_plan }}],
                backgroundColor: ["#00A300", "#E0E0E0"],
                borderWidth: 0
            }]
        },
        options: {
            responsive:true,
            cutout:"75%",
            plugins:{ legend:{ display:false } }
        }
    });
});
</script>

{% include "dashboard/OIH/_oih_card.html" with data=local %}
