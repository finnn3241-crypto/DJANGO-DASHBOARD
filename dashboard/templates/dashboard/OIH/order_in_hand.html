{% extends "dashboard/base.html" %}
{% block content %}

{% load humanize %}

<style>

body { 
    margin:0; 
    padding:0; 
    background:#f5f6f8; 
    font-family: 'IBM Plex Sans', system-ui, sans-serif;  
}

.cards{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(320px,1fr));
    gap:24px;
    padding:20px;
    max-width:1400px;
    margin:0 auto;
}

.export-card-wrapper{
    background:#eceef1;
    border-radius:16px;
    box-shadow:0 6px 14px rgba(0,0,0,.12);
    overflow:hidden;
    border:1px solid #d8dbe0;
    display:flex;
    flex-direction:column;
}



.export-title{
    background:#8fbc8f;
    color:#000000;
    text-align:center;
    padding:12px;
    font-weight:700;
    font-size:25px;
    letter-spacing:.8px;
    text-transform:uppercase;
}
.cardInv{
    background:#e5e7eb;border-radius:16px;
    box-shadow:0 6px 14px rgba(0,0,0,.18);
    padding-bottom:20px;
    border: 1px solid #eee;
}

.chart-container{text-align:center;margin:22px 0}
.chart-container canvas{
    width:90px !important;
    height:90px !important;
    margin:0 auto;
    display:block;
}

.chart-container b{font-size:17px}
.stat-line{font-weight:700;margin-top:8px; font-size:16px;}
.stat-line-second{color:#2d2d2d; font-size:14px;}

.valueCell{font-size:30px;font-weight:700;text-align:center}
.valueCelltxt{font-size:21px;font-weight:700;text-align:center;color:#b10000}

.mgr-row{margin:10px 16px}
.mgr-name{display:flex;justify-content:space-between;font-weight:600}
.bar-outer{background:#e5e7eb;border-radius:20px;height:14px;margin-top:4px}
.bar-inner{height:14px;border-radius:20px;font-size:12px;font-weight:700;text-align:center}

.cardHeader{
    text-align: center;
    font-weight: 800;
    font-size: 14px;
    padding: 6px 10px;
    border-radius: 12px;
    margin: 0 auto 10px;
    width: max-content;
    letter-spacing: .6px;
    background: #82d9f3;
}

.sectionBox{
    background:#fff;
    border-radius:16px;
    padding:12px;
    margin-top:14px;
    box-shadow:0 2px 6px rgba(0,0,0,.08);
    border:1px solid #eee;
}   

</style>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<div class="max-w-[1400px] mx-auto mt-5 mb-5 px-4 text-center">
    <h1 class="font-bold text-2xl md:text-3xl uppercase border-b border-gray-300 pb-3 tracking-wider text-slate-800">
        Order In Hand
    </h1>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="cards">

<!-- ================= EXPORT CARD ================= -->
<div class="export-card-wrapper">
<div class="export-title">EXPORT</div>
<div className="chart-section">
<div class="chart-container">
<b>Order In Hand</b>
<canvas id="chartExport" width="90" height="90"></canvas>
<div class="stat-line">{{ export.percentage }}% of Overall Order In Hand</div>
<div class="stat-line-second">({{ export.curr_dispatch }} mtr / {{ export.total_plan }} mtr)</div>
</div>

<div class="sectionBox">

<div class="mgr-row">
<div class="mgr-name">Matched Fabric Inventory <span>{{ export.inventory }}</span></div>
<div class="bar-outer">
<div class="bar-inner" style="width:{{ export.inv_per }}%;background:#e67e22">{{ export.inv_per }}%</div>
</div>
</div>

<table width="100%">
<tr><td class="valueCell">{{ export.curr_dispatch }} MTR</td></tr>
<tr><td class="valueCell">{{ export.amt_pkr }} PKR</td></tr>
<tr><td class="valueCell">{{ export.amt }} @{{ export.d_rate }} $</td></tr>
<tr><td class="valueCell">{{ export.avg_rate }} AVG RATE</td></tr>
<tr><td class="valueCelltxt">BAL TO DYE {{ export.btd }}</td></tr>
<tr><td class="valueCelltxt">{{ export.days }} DAYS</td></tr>
</table>

<div class="sectionBox" style="margin-top:20px">
<div class="cardHeader">MANAGER WISE</div>
{% for m in export.managers %}
<div class="mgr-row">
<div class="mgr-name">{{ m.manager_name }} <span>{{ m.dispatch_exp }}</span></div>
<div class="bar-outer">
<div class="bar-inner" style="width:{{ m.per }}%;background:#e67e22">{{ m.per }}%</div>
</div>
</div>
{% endfor %}
</div>

</div>
</div>

</div>

<!-- ================= LOCAL CARD ================= -->
<div class="export-card-wrapper">
<div class="export-title">LOCAL</div>
<div class="cardInv">

<div class="chart-container">
<b>Order In Hand</b>
<canvas id="chartLocal" width="90" height="90"></canvas>
<div class="stat-line">{{ local.percentage }}% of Overall Order In Hand</div>
<div class="stat-line-second">({{ local.curr_dispatch }} mtr / {{ local.total_plan }} mtr)</div>
</div>

<div class="sectionBox">
<div class="mgr-row">
<div class="mgr-name">Matched Fabric Inventory <span>{{ local.inventory }}</span></div>
<div class="bar-outer">
<div class="bar-inner" style="width:{{ local.inv_per }}%;background:#e67e22">{{ local.inv_per }}%</div>
</div>
</div>

<table width="100%">
<tr><td class="valueCell">{{ local.curr_dispatch }} MTR</td></tr>
<tr><td class="valueCell">{{ local.amt_pkr }} PKR</td></tr>
<tr><td class="valueCell">{{ local.amt }} @{{ local.d_rate }} $</td></tr>
<tr><td class="valueCell">{{ local.avg_rate }} AVG RATE</td></tr>
<tr><td class="valueCelltxt">BAL TO DYE {{ local.btd }}</td></tr>
<tr><td class="valueCelltxt">{{ local.days }} DAYS</td></tr>
</table>

<div class="sectionBox" style="margin-top:20px">
<div class="cardHeader">MANAGER WISE</div>
{% for m in local.managers %}
<div class="mgr-row">
<div class="mgr-name">{{ m.manager_name }} <span>{{ m.dispatch_exp }}</span></div>
<div class="bar-outer">
<div class="bar-inner" style="width:{{ m.per }}%;background:#e67e22">{{ m.per }}%</div>
</div>
</div>
{% endfor %}
</div>
</div>
</div>
</div>

<!-- ================= TOTAL CARD ================= -->
<div class="export-card-wrapper">
<div class="export-title">TOTAL</div>
<div class="cardInv">

<div class="chart-container">
<b>Order In Hand</b>
<canvas id="chartTotal" width="90" height="90"></canvas>
<div class="stat-line">{{ total.percentage }}% of Overall Order In Hand</div>
<div class="stat-line-second">Total Export/Local Order In Hand: {{ total.total_plan }} mtr</div>
</div>

<div class="sectionBox">

<div class="mgr-row">
<div class="mgr-name">Matched Fabric Inventory <span>{{ total.inventory }}</span></div>
<div class="bar-outer">
<div class="bar-inner" style="width:{{ total.inv_per }}%;background:#e67e22">{{ total.inv_per }}%</div>
</div>
</div>

<table width="100%">
<tr><td class="valueCell">{{ total.curr_dispatch }} MTR</td></tr>
<tr><td class="valueCell">{{ total.amt_pkr }} PKR</td></tr>
<tr><td class="valueCell">{{ total.amt }} @{{ total.d_rate }} $</td></tr>
<tr><td class="valueCell">{{ total.avg_rate }} AVG RATE</td></tr>
<tr><td class="valueCelltxt">BAL TO DYE {{ total.btd }}</td></tr>
<tr><td class="valueCelltxt">{{ total.days }} DAYS</td></tr>
</table>

<div class="sectionBox" style="margin-top:20px">
<div class="cardHeader">MANAGER WISE</div>
{% for m in total.managers %}
<div class="mgr-row">
<div class="mgr-name">{{ m.manager_name }} <span>{{ m.dispatch_exp }}</span></div>
<div class="bar-outer">
<div class="bar-inner" style="width:{{ m.per }}%;background:#e67e22">{{ m.per }}%</div>
</div>
</div>
{% endfor %}
</div>
</div>
</div>
</div>
</div>

<script>
function animatedDonut(id, val, total, color){
    let ctx=document.getElementById(id)
    let i=0
    let chart=new Chart(ctx,{
        type:'doughnut',
        data:{datasets:[{data:[0,total],backgroundColor:[color,'#ddd'],borderWidth:0}]},
        options:{cutout:'72%',plugins:{legend:{display:false}}}
    })
    let timer=setInterval(()=>{
        if(i>=val){clearInterval(timer);return}
        i+=Math.ceil(val/60)
        chart.data.datasets[0].data=[i,total]
        chart.update()
    },15)
}

animatedDonut('chartExport', {{ export.curr_dispatch|cut:"," }}, {{ export.total_plan|cut:"," }}, '#00A300')
animatedDonut('chartLocal', {{ local.curr_dispatch|cut:"," }}, {{ local.total_plan|cut:"," }}, '#0077ff')
animatedDonut('chartTotal', {{ total.curr_dispatch|cut:"," }}, {{ 0 }}, '#ff0000')

</script>
{% endblock %}